<nav class="navbar navbar-expand-md navbar-light bg-light">
    <!-- Logo as Brand -->
    <a class="navbar-brand d-flex align-items-center" href="{% if page.language == 'zh' %}/zh{% else %}/{{ page.url }}{% endif %}">
        <img src="{{ '/assets/images/logo.jpg' | relative_url }}" alt="My Site Logo" class="navbar-logo rounded-circle">
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="{% if page.language == 'zh' %}/zh{% else %}/{% endif %}">
                    {% if page.language == 'en' %}
                        {{ site.data.en.home }}
                    {% elsif page.language == 'zh' %}
                        {{ site.data.zh.home }}
                    {% else %}
                        {{ site.data.en.home }} <!-- 預設為英文 -->
                    {% endif %}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% if page.language == 'zh' %}/zh{% else %}/resume.html{% endif %}">
                    {% if page.language == 'en' %}
                        {{ site.data.en.resume }}
                    {% elsif page.language == 'zh' %}
                        {{ site.data.zh.resume }}
                    {% else %}
                        {{ site.data.en.resume }} <!-- 預設為英文 -->
                    {% endif %}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% if page.language == 'zh' %}/zh{% else %}/blog.html{% endif %}">
                    {% if page.language == 'en' %}
                        {{ site.data.en.blog }}
                    {% elsif page.language == 'zh' %}
                        {{ site.data.zh.blog }}
                    {% else %}
                        {{ site.data.en.blog }} <!-- 預設為英文 -->
                    {% endif %}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% if page.language == 'zh' %}/zh{% else %}/portfolio.html{% endif %}">
                    {% if page.language == 'en' %}
                        {{ site.data.en.portfolio }}
                    {% elsif page.language == 'zh' %}
                        {{ site.data.zh.portfolio }}
                    {% else %}
                        {{ site.data.en.portfolio }} <!-- 預設為英文 -->
                    {% endif %}
                </a>
            </li>
        </ul>
    </div>

    <!-- Language Switcher Combo Box -->
    <ul class="navbar-nav ml-auto">
        <li class="nav-item">
            <form id="language-form" action="" method="get" class="form-inline">
                <select name="lang" class="form-control" onchange="updateLanguage(this)">
                    <option value="en" {% if page.language == 'en' %}selected{% endif %}>English</option>
                    <option value="zh" {% if page.language == 'zh' %}selected{% endif %}>中文</option>
                </select>
            </form>
        </li>
    </ul>
</nav>

<script>
    function updateLanguage(selectElement) {
        const lang = selectElement.value;
        const currentPath = window.location.pathname;
        const pathSegments = currentPath.split('/').filter(Boolean); // 分割路径并去掉空值
        
        if (lang === 'en') {
            // 英文页面，不需要前缀
            if (pathSegments[0] === 'zh') {
                // 如果当前路径是中文页面，去掉前缀并重定向到英文页面
                const newPath = `/${pathSegments.slice(1).join('/')}`; // 去掉 'zh' 前缀
                window.location.href = newPath === '' ? '/' : newPath;
            } else {
                // 如果当前路径已经是英文页面或根路径，保持不变
                window.location.href = currentPath === '/' ? '/' : currentPath;
            }
        } else if (lang === 'zh') {
            // 中文页面，需要 'zh' 前缀
            if (pathSegments[0] !== 'zh') {
                // 如果当前路径没有中文前缀，添加 'zh' 前缀
                const newPath = `/zh${currentPath === '/' ? '/' : currentPath}`;
                window.location.href = newPath;
            } else {
                // 如果当前路径已经是中文页面，保持不变
                window.location.href = currentPath;
            }
        }
    }
</script>
